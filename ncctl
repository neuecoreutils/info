#!/usr/bin/env bash

# ncctl - build and/or install coreutils.
# Warn: this may not work.

src='./src/'
bin='./bin/'
prefix='/usr'

install() {
    install -m 0755 bin/NCmkdir $prefix/bin/NCmkdir    
    install -m 0755 bin/NCtouch $prefix/bin/NCtouch    
    install -m 0755 bin/NCln $prefix/bin/NCln    
    install -m 0755 bin/NCls $prefix/bin/NCls    
    install -m 0755 bin/NCrm $prefix/bin/NCrm
    install -m 0755 bin/NCdate $prefix/bin/NCdate
    install -m 0755 bin/NCuname $prefix/bin/NCuname
    echo "Installed."    
    echo "Note that all Neuecoreutils apps have the 'NC' prefix."

    if [ $? == 1 ]; then
        echo "$0: Installation failed"
        exit 1
    elif [ $? == 0 ]; then
        echo "$0: Installation successful."
        exit 0
    else
        echo "$0: Unknown error?"
    fi    
}

build() {
    mkdir bin/
    swiftc src/ln.swift -o bin/NCln
    swiftc src/ls.swift -o bin/NCls
    swiftc src/mkdir.swift -o bin/NCmkdir
    swiftc src/rm.swift -o bin/rm
    swiftc src/touch.swift -o bin/NCtouch
    swiftc src/date.swift -o bin/NCdate
    swiftc src/mv.swift -o bin/NCmv
    swiftc src/cp.swift -o bin/NCcp
    swiftc src/whoami.swift -o bin/NCwhoami
    gcc src/c/uname.c -o bin/NCuname

    if [ $? == 1 ]; then
        echo "$0: Compilation failed"
        exit 1
    elif [ $? == 0 ]; then
        echo "$0: Compilation successful."
        exit 0
    else
        echo "$0: Unknown error?"
        exit 1
    fi
}

uninstall() {
    rm -f $prefix/bin/NCmkdir    
    rm -f $prefix/bin/NCtouch    
    rm -f $prefix/bin/NCln    
    rm -f $prefix/bin/NCls    
    rm -f $prefix/bin/NCrm
    rm -f $prefix/bin/NCuname
    rm -f $prefix/bin/NCdate

    if [ $? == 1 ]; then
        echo "$0: Installation failed"
        exit 1
    elif [ $? == 0 ]; then
        echo "$0: Neuecoreutils have been uninstalled."
        exit 0
    else
        echo "$0: Unknown error?"
        exit 1
    fi    
}


case "$1" in
    "--install")
        install
    "--build")
        build
    "--uninstall")
        uninstall
    *)
        echo "$0: Error: No command given."
        exit 127
esac